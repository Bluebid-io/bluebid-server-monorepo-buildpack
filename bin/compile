#!/usr/bin/env bash
set -euo pipefail

# $1 = build dir
cd "$1"
[[ ! -d api-server && -d bluebid-server ]] && cd bluebid-server

# require SERVICE env var
if [[ -z "${SERVICE:-}" ]]; then
  echo "✖ SERVICE must be set to api-server or jobs-server" >&2
  exit 1
fi

echo "→ npm install in root"
npm install

cd "$SERVICE"
echo "→ npm install in $SERVICE"
npm install

echo "→ building $SERVICE"
npm run build
cd ..

echo "→ copying Procfile from $SERVICE/Procfile to root"
cp "$SERVICE/Procfile" Procfile

echo "→ echoing Procfile"
cat Procfile

echo "✔ compile done for $SERVICE"
